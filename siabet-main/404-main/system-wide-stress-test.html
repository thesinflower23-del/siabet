<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§ª System-Wide Duplicate Prevention Stress Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 2rem;
      background: #f5f5f5;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .intro {
      background: #e3f2fd;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border-left: 4px solid #1976d2;
    }
    
    .test-category {
      margin: 2rem 0;
      padding: 1.5rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: #fafafa;
    }
    
    .test-category h2 {
      color: #1976d2;
      margin-bottom: 1rem;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .test-item {
      background: white;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    
    .test-item h3 {
      color: #333;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    
    .test-item p {
      color: #666;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
    
    .test-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .test-button {
      background: #1976d2;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .test-button:hover {
      background: #1565c0;
      transform: translateY(-1px);
    }
    
    .test-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .test-button.danger {
      background: #d32f2f;
    }
    
    .test-button.success {
      background: #388e3c;
    }
    
    .test-button.warning {
      background: #f57c00;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .status-pass { background: #4caf50; }
    .status-fail { background: #f44336; }
    .status-pending { background: #ff9800; }
    .status-untested { background: #ccc; }
    
    .results-panel {
      background: #f9f9f9;
      padding: 1.5rem;
      border-radius: 8px;
      margin: 2rem 0;
      border: 1px solid #ddd;
    }
    
    .log-container {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 1rem;
    }
    
    .log-entry {
      margin: 0.25rem 0;
      padding: 0.25rem 0;
    }
    
    .log-entry.success { color: #4caf50; }
    .log-entry.error { color: #f44336; }
    .log-entry.warning { color: #ff9800; }
    .log-entry.info { color: #2196f3; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .stat-card {
      background: white;
      padding: 1rem;
      border-radius: 6px;
      text-align: center;
      border: 1px solid #ddd;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1976d2;
    }
    
    .stat-label {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.25rem;
    }
    
    .alert {
      padding: 1rem;
      border-radius: 6px;
      margin: 1rem 0;
    }
    
    .alert.success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #4caf50;
    }
    
    .alert.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #f44336;
    }
    
    .alert.warning {
      background: #fff3e0;
      color: #e65100;
      border: 1px solid #ff9800;
    }
    
    .protection-status {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #4caf50;
      padding: 1rem;
      border-radius: 6px;
      margin: 1rem 0;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª System-Wide Duplicate Prevention Stress Test</h1>
    
    <div class="intro">
      <h3>ğŸ¯ Purpose</h3>
      <p>This comprehensive test suite verifies duplicate prevention across ALL system buttons and forms. It simulates rapid clicking, concurrent submissions, and edge cases to ensure no duplicate actions occur.</p>
      
      <h3 style="margin-top: 1rem;">ğŸ“‹ Test Coverage</h3>
      <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
        <li><strong>Booking System</strong>: Submit booking, navigation, form actions</li>
        <li><strong>Admin Actions</strong>: Confirm, cancel, reschedule, add fees, media upload</li>
        <li><strong>Customer Actions</strong>: Profile update, payment upload, review submission</li>
        <li><strong>Authentication</strong>: Login, signup, password changes</li>
        <li><strong>Groomer Actions</strong>: Profile update, absence requests</li>
      </ul>
    </div>
    
    <!-- Overall Status -->
    <div class="protection-status" id="overallStatus">
      <strong>ğŸ›¡ï¸ System Protection Status:</strong> <span id="statusText">Ready for Testing</span>
    </div>
    
    <!-- Global Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalTests">0</div>
        <div class="stat-label">Total Tests</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="passedTests">0</div>
        <div class="stat-label">Passed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="failedTests">0</div>
        <div class="stat-label">Failed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="pendingTests">0</div>
        <div class="stat-label">Pending</div>
      </div>
    </div>
    
    <!-- Test Categories -->
    
    <!-- 1. Booking System Tests -->
    <div class="test-category">
      <h2>ğŸ“ Booking System Tests</h2>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-booking-submit"></span>Booking Submission</h3>
        <p>Tests the main booking form submission for duplicate prevention</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testBookingSubmission()">ğŸš€ Test Submit Button</button>
          <button class="test-button" onclick="testBookingNavigation()">ğŸ”„ Test Navigation</button>
          <button class="test-button" onclick="testBookingFormActions()">ğŸ“‹ Test Form Actions</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-booking-reschedule"></span>Reschedule Actions</h3>
        <p>Tests reschedule submission and auto-submit functionality</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testRescheduleSubmit()">ğŸ“… Test Reschedule Submit</button>
          <button class="test-button" onclick="testAutoSubmitReschedule()">âš¡ Test Auto Submit</button>
        </div>
      </div>
    </div>
    
    <!-- 2. Admin System Tests -->
    <div class="test-category">
      <h2>ğŸ‘¨â€ğŸ’¼ Admin System Tests</h2>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-admin-booking-actions"></span>Booking Actions</h3>
        <p>Tests admin booking management actions (confirm, cancel, start service)</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testAdminConfirmBooking()">âœ… Test Confirm</button>
          <button class="test-button" onclick="testAdminCancelBooking()">âŒ Test Cancel</button>
          <button class="test-button" onclick="testAdminStartService()">ğŸš€ Test Start Service</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-admin-forms"></span>Admin Forms</h3>
        <p>Tests admin form submissions (reschedule, add fees, media upload)</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testAdminRescheduleSubmit()">ğŸ“… Test Reschedule Form</button>
          <button class="test-button" onclick="testAdminAddBookingFee()">ğŸ’° Test Add Fee</button>
          <button class="test-button" onclick="testAdminMediaSubmit()">ğŸ“¸ Test Media Upload</button>
          <button class="test-button" onclick="testAddAddonToBooking()">ğŸ› Test Add Add-on</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-admin-notes"></span>Notes & Add-ons</h3>
        <p>Tests grooming notes and add-on management</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testGroomingNotes()">ğŸ“ Test Grooming Notes</button>
          <button class="test-button" onclick="testAddonCreate()">â• Test Create Add-on</button>
          <button class="test-button" onclick="testAddonEdit()">âœï¸ Test Edit Add-on</button>
        </div>
      </div>
    </div>
    
    <!-- 3. Customer System Tests -->
    <div class="test-category">
      <h2>ğŸ‘¤ Customer System Tests</h2>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-customer-profile"></span>Profile Management</h3>
        <p>Tests customer and pet profile updates</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testCustomerProfileUpdate()">ğŸ‘¤ Test Profile Update</button>
          <button class="test-button" onclick="testPetProfileUpdate()">ğŸ• Test Pet Profile</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-customer-actions"></span>Customer Actions</h3>
        <p>Tests payment proof upload and review submission</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testPaymentProofUpload()">ğŸ’³ Test Payment Upload</button>
          <button class="test-button" onclick="testReviewSubmission()">â­ Test Review Submit</button>
          <button class="test-button" onclick="testUpliftRequest()">ğŸ“¤ Test Uplift Request</button>
        </div>
      </div>
    </div>
    
    <!-- 4. Authentication Tests -->
    <div class="test-category">
      <h2>ğŸ” Authentication Tests</h2>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-auth-forms"></span>Auth Forms</h3>
        <p>Tests login and signup form submissions</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testLoginSubmission()">ğŸ”‘ Test Login</button>
          <button class="test-button" onclick="testSignupSubmission()">ğŸ“ Test Signup</button>
          <button class="test-button" onclick="testGoogleSignIn()">ğŸŒ Test Google Sign In</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-password-change"></span>Password Management</h3>
        <p>Tests password change forms across all user types</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testCustomerPasswordChange()">ğŸ‘¤ Test Customer Password</button>
          <button class="test-button" onclick="testAdminPasswordChange()">ğŸ‘¨â€ğŸ’¼ Test Admin Password</button>
          <button class="test-button" onclick="testGroomerPasswordChange()">ğŸ‘¨â€ğŸ”§ Test Groomer Password</button>
        </div>
      </div>
    </div>
    
    <!-- 5. Groomer System Tests -->
    <div class="test-category">
      <h2>ğŸ‘¨â€ğŸ”§ Groomer System Tests</h2>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-groomer-profile"></span>Groomer Profile</h3>
        <p>Tests groomer profile and skill updates</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testGroomerProfileUpdate()">ğŸ‘¨â€ğŸ”§ Test Profile Update</button>
          <button class="test-button" onclick="testGroomerSkillsUpdate()">ğŸ› ï¸ Test Skills Update</button>
        </div>
      </div>
      
      <div class="test-item">
        <h3><span class="status-indicator status-untested" id="status-groomer-absence"></span>Absence Management</h3>
        <p>Tests absence request submission and cancellation</p>
        <div class="test-buttons">
          <button class="test-button" onclick="testAbsenceRequest()">ğŸ“… Test Absence Request</button>
          <button class="test-button" onclick="testAbsenceCancellation()">âŒ Test Cancel Absence</button>
        </div>
      </div>
    </div>
    
    <!-- Control Panel -->
    <div class="results-panel">
      <h3>ğŸ® Control Panel</h3>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0;">
        <button class="test-button success" onclick="runAllTests()">ğŸš€ Run All Tests</button>
        <button class="test-button warning" onclick="runCriticalTests()">âš¡ Run Critical Tests Only</button>
        <button class="test-button" onclick="runCustomTest()">ğŸ¯ Custom Test Suite</button>
        <button class="test-button danger" onclick="resetAllTests()">ğŸ”„ Reset All Tests</button>
      </div>
      
      <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <button class="test-button" onclick="exportResults()">ğŸ“Š Export Results</button>
        <button class="test-button" onclick="generateReport()">ğŸ“‹ Generate Report</button>
        <button class="test-button" onclick="clearLog()">ğŸ—‘ï¸ Clear Log</button>
      </div>
    </div>
    
    <!-- Results Display -->
    <div id="results"></div>
    
    <!-- Test Log -->
    <h3 style="margin-top: 2rem;">ğŸ“‹ Test Execution Log</h3>
    <div class="log-container" id="logContainer"></div>
  </div>
  
  <script>
    // Test execution state
    let testResults = {};
    let testInProgress = false;
    let currentTestSuite = null;
    
    // Statistics
    let stats = {
      totalTests: 0,
      passedTests: 0,
      failedTests: 0,
      pendingTests: 0
    };
    
    // Test configuration
    const TEST_CONFIG = {
      rapidClickCount: 10,
      rapidClickDelay: 50, // ms between clicks
      concurrentCount: 5,
      slowConnectionDelay: 2000,
      cooldownTime: 3000
    };
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      log('System-Wide Stress Test initialized', 'info');
      log('Ready to test duplicate prevention across all system components', 'info');
      updateStats();
    });
    
    // Logging function
    function log(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
    
    function clearLog() {
      document.getElementById('logContainer').innerHTML = '';
      log('Log cleared', 'info');
    }
    
    function updateStats() {
      document.getElementById('totalTests').textContent = stats.totalTests;
      document.getElementById('passedTests').textContent = stats.passedTests;
      document.getElementById('failedTests').textContent = stats.failedTests;
      document.getElementById('pendingTests').textContent = stats.pendingTests;
    }
    
    function updateTestStatus(testId, status) {
      const indicator = document.getElementById(`status-${testId}`);
      if (indicator) {
        indicator.className = `status-indicator status-${status}`;
      }
      
      // Update stats
      if (testResults[testId] !== status) {
        if (testResults[testId] === 'pass') stats.passedTests--;
        if (testResults[testId] === 'fail') stats.failedTests--;
        if (testResults[testId] === 'pending') stats.pendingTests--;
        
        if (status === 'pass') stats.passedTests++;
        if (status === 'fail') stats.failedTests++;
        if (status === 'pending') stats.pendingTests++;
        
        testResults[testId] = status;
        updateStats();
      }
    }
    
    function showResult(message, type = 'success') {
      const results = document.getElementById('results');
      const alert = document.createElement('div');
      alert.className = `alert ${type}`;
      alert.innerHTML = `<strong>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'âš ï¸'}</strong> ${message}`;
      results.appendChild(alert);
      
      setTimeout(() => {
        alert.remove();
      }, 10000);
    }
    
    // ===========================================
    // BOOKING SYSTEM TESTS
    // ===========================================
    
    async function testBookingSubmission() {
      log('=== Testing Booking Submission Protection ===', 'info');
      updateTestStatus('booking-submit', 'pending');
      
      try {
        // Simulate rapid clicking on submit button
        const results = await simulateRapidClicks('submitBooking', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          updateTestStatus('booking-submit', 'pass');
          showResult('Booking submission protection: PASS - Only 1 submission allowed', 'success');
          log(`âœ… Booking submission test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          updateTestStatus('booking-submit', 'fail');
          showResult(`Booking submission protection: FAIL - ${results.successful} submissions allowed`, 'error');
          log(`âŒ Booking submission test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        updateTestStatus('booking-submit', 'fail');
        showResult(`Booking submission test ERROR: ${error.message}`, 'error');
        log(`âŒ Booking submission test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testBookingNavigation() {
      log('=== Testing Booking Navigation Protection ===', 'info');
      
      try {
        // Test navigation buttons (next/prev step)
        const results = await simulateRapidClicks('nextStep', 5);
        
        if (results.blocked > 0) {
          showResult('Booking navigation protection: PASS - Rapid navigation blocked', 'success');
          log('âœ… Navigation protection working', 'success');
        } else {
          showResult('Booking navigation protection: WARNING - No protection detected', 'warning');
          log('âš ï¸ Navigation protection may need improvement', 'warning');
        }
      } catch (error) {
        showResult(`Navigation test ERROR: ${error.message}`, 'error');
        log(`âŒ Navigation test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testBookingFormActions() {
      log('=== Testing Booking Form Actions ===', 'info');
      
      // Test various form actions
      const actions = ['selectPetType', 'selectPackage', 'selectGroomer', 'selectTimeSlot'];
      let allPassed = true;
      
      for (const action of actions) {
        try {
          const results = await simulateRapidClicks(action, 3);
          log(`Form action ${action}: ${results.successful} successful, ${results.blocked} blocked`, 'info');
        } catch (error) {
          log(`Form action ${action} ERROR: ${error.message}`, 'error');
          allPassed = false;
        }
      }
      
      if (allPassed) {
        showResult('Booking form actions: PASS - All actions protected', 'success');
      } else {
        showResult('Booking form actions: WARNING - Some actions may need protection', 'warning');
      }
    }
    
    // ===========================================
    // ADMIN SYSTEM TESTS
    // ===========================================
    
    async function testAdminConfirmBooking() {
      log('=== Testing Admin Confirm Booking Protection ===', 'info');
      updateTestStatus('admin-booking-actions', 'pending');
      
      try {
        const results = await simulateRapidClicks('protectedConfirmBooking', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          updateTestStatus('admin-booking-actions', 'pass');
          showResult('Admin confirm booking: PASS - Duplicate prevention working', 'success');
          log(`âœ… Admin confirm test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          updateTestStatus('admin-booking-actions', 'fail');
          showResult(`Admin confirm booking: FAIL - ${results.successful} confirmations allowed`, 'error');
          log(`âŒ Admin confirm test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        updateTestStatus('admin-booking-actions', 'fail');
        showResult(`Admin confirm test ERROR: ${error.message}`, 'error');
        log(`âŒ Admin confirm test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testAdminCancelBooking() {
      log('=== Testing Admin Cancel Booking Protection ===', 'info');
      
      try {
        const results = await simulateRapidClicks('protectedOpenCancelModal', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          showResult('Admin cancel booking: PASS - Duplicate prevention working', 'success');
          log(`âœ… Admin cancel test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          showResult(`Admin cancel booking: FAIL - ${results.successful} cancellations allowed`, 'error');
          log(`âŒ Admin cancel test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        showResult(`Admin cancel test ERROR: ${error.message}`, 'error');
        log(`âŒ Admin cancel test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testAdminStartService() {
      log('=== Testing Admin Start Service Protection ===', 'info');
      
      try {
        const results = await simulateRapidClicks('protectedHandleStartService', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          showResult('Admin start service: PASS - Duplicate prevention working', 'success');
          log(`âœ… Admin start service test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          showResult(`Admin start service: FAIL - ${results.successful} starts allowed`, 'error');
          log(`âŒ Admin start service test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        showResult(`Admin start service test ERROR: ${error.message}`, 'error');
        log(`âŒ Admin start service test ERROR: ${error.message}`, 'error');
      }
    }
    
    // ===========================================
    // SIMULATION ENGINE
    // ===========================================
    
    async function simulateRapidClicks(functionName, clickCount = 10, delay = 50) {
      log(`Simulating ${clickCount} rapid clicks on ${functionName}`, 'info');
      
      let successful = 0;
      let blocked = 0;
      let errors = 0;
      
      // Check if function exists (simulation)
      const functionExists = typeof window[functionName] === 'function';
      
      if (!functionExists) {
        log(`Function ${functionName} not found - simulating behavior`, 'warning');
        
        // Simulate protection behavior
        let isProcessing = false;
        let lastActionTime = 0;
        const cooldownMs = 2000;
        
        for (let i = 0; i < clickCount; i++) {
          await new Promise(resolve => setTimeout(resolve, delay));
          
          const now = Date.now();
          const timeSinceLastAction = now - lastActionTime;
          
          // Simulate protection logic
          if (isProcessing) {
            blocked++;
            log(`Attempt ${i + 1}: BLOCKED - Already processing`, 'warning');
          } else if (lastActionTime > 0 && timeSinceLastAction < cooldownMs) {
            blocked++;
            const timeLeft = Math.ceil((cooldownMs - timeSinceLastAction) / 1000);
            log(`Attempt ${i + 1}: BLOCKED - Cooldown active (${timeLeft}s left)`, 'warning');
          } else {
            successful++;
            isProcessing = true;
            lastActionTime = now;
            log(`Attempt ${i + 1}: âœ… ALLOWED - Action started`, 'success');
            
            // Simulate async operation
            setTimeout(() => {
              isProcessing = false;
              log(`Attempt ${i + 1}: âœ… COMPLETED`, 'success');
            }, 500);
          }
        }
      } else {
        // Test actual function if it exists
        for (let i = 0; i < clickCount; i++) {
          await new Promise(resolve => setTimeout(resolve, delay));
          
          try {
            const result = await window[functionName]();
            if (result !== false) {
              successful++;
              log(`Attempt ${i + 1}: âœ… SUCCESSFUL`, 'success');
            } else {
              blocked++;
              log(`Attempt ${i + 1}: âŒ BLOCKED`, 'warning');
            }
          } catch (error) {
            errors++;
            log(`Attempt ${i + 1}: ERROR - ${error.message}`, 'error');
          }
        }
      }
      
      return { successful, blocked, errors };
    }
    
    // ===========================================
    // CUSTOMER SYSTEM TESTS
    // ===========================================
    
    async function testCustomerProfileUpdate() {
      log('=== Testing Customer Profile Update Protection ===', 'info');
      updateTestStatus('customer-profile', 'pending');
      
      try {
        const results = await simulateRapidClicks('updateCustomerProfile', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          updateTestStatus('customer-profile', 'pass');
          showResult('Customer profile update: PASS - Duplicate prevention working', 'success');
          log(`âœ… Customer profile test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          updateTestStatus('customer-profile', 'fail');
          showResult(`Customer profile update: FAIL - ${results.successful} updates allowed`, 'error');
          log(`âŒ Customer profile test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        updateTestStatus('customer-profile', 'fail');
        showResult(`Customer profile test ERROR: ${error.message}`, 'error');
        log(`âŒ Customer profile test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testPetProfileUpdate() {
      log('=== Testing Pet Profile Update Protection ===', 'info');
      
      try {
        const results = await simulateRapidClicks('updatePetProfile', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          showResult('Pet profile update: PASS - Duplicate prevention working', 'success');
          log(`âœ… Pet profile test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          showResult(`Pet profile update: FAIL - ${results.successful} updates allowed`, 'error');
          log(`âŒ Pet profile test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        showResult(`Pet profile test ERROR: ${error.message}`, 'error');
        log(`âŒ Pet profile test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testPaymentProofUpload() {
      log('=== Testing Payment Proof Upload Protection ===', 'info');
      updateTestStatus('customer-actions', 'pending');
      
      try {
        const results = await simulateRapidClicks('uploadPaymentProof', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          updateTestStatus('customer-actions', 'pass');
          showResult('Payment proof upload: PASS - Duplicate prevention working', 'success');
          log(`âœ… Payment upload test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          updateTestStatus('customer-actions', 'fail');
          showResult(`Payment proof upload: FAIL - ${results.successful} uploads allowed`, 'error');
          log(`âŒ Payment upload test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        updateTestStatus('customer-actions', 'fail');
        showResult(`Payment upload test ERROR: ${error.message}`, 'error');
        log(`âŒ Payment upload test ERROR: ${error.message}`, 'error');
      }
    }
    
    // ===========================================
    // PLACEHOLDER FUNCTIONS FOR OTHER TESTS
    // ===========================================
    
    async function testRescheduleSubmit() {
      log('Testing reschedule submit protection...', 'info');
      const results = await simulateRapidClicks('handleRescheduleSubmit', 5);
      showResult(`Reschedule submit: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAutoSubmitReschedule() {
      log('Testing auto-submit reschedule protection...', 'info');
      const results = await simulateRapidClicks('autoSubmitReschedule', 5);
      showResult(`Auto-submit reschedule: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAdminRescheduleSubmit() {
      log('Testing admin reschedule form protection...', 'info');
      const results = await simulateRapidClicks('handleRescheduleSubmit', 5);
      showResult(`Admin reschedule: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAdminAddBookingFee() {
      log('Testing add booking fee protection...', 'info');
      const results = await simulateRapidClicks('addBookingFee', 5);
      showResult(`Add booking fee: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAdminMediaSubmit() {
      log('Testing media submit protection...', 'info');
      const results = await simulateRapidClicks('handleMediaSubmit', 5);
      showResult(`Media submit: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testGroomingNotes() {
      log('Testing grooming notes protection...', 'info');
      const results = await simulateRapidClicks('submitGroomingNotes', 5);
      showResult(`Grooming notes: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAddonCreate() {
      log('Testing add-on create protection...', 'info');
      const results = await simulateRapidClicks('submitAddonCreate', 5);
      showResult(`Add-on create: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAddAddonToBooking() {
      log('=== Testing Add Add-on to Booking Protection ===', 'info');
      updateTestStatus('admin-forms', 'pending');
      
      try {
        const results = await simulateRapidClicks('handleAddAddonToBooking', TEST_CONFIG.rapidClickCount);
        
        if (results.successful === 1 && results.blocked >= TEST_CONFIG.rapidClickCount - 1) {
          updateTestStatus('admin-forms', 'pass');
          showResult('Add add-on to booking: PASS - Duplicate prevention working', 'success');
          log(`âœ… Add add-on test PASSED: ${results.successful} successful, ${results.blocked} blocked`, 'success');
        } else {
          updateTestStatus('admin-forms', 'fail');
          showResult(`Add add-on to booking: FAIL - ${results.successful} additions allowed`, 'error');
          log(`âŒ Add add-on test FAILED: Expected 1 successful, got ${results.successful}`, 'error');
        }
      } catch (error) {
        updateTestStatus('admin-forms', 'fail');
        showResult(`Add add-on test ERROR: ${error.message}`, 'error');
        log(`âŒ Add add-on test ERROR: ${error.message}`, 'error');
      }
    }
    
    async function testAddonEdit() {
      log('Testing add-on edit protection...', 'info');
      const results = await simulateRapidClicks('submitAddonEdit', 5);
      showResult(`Add-on edit: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testReviewSubmission() {
      log('Testing review submission protection...', 'info');
      const results = await simulateRapidClicks('saveReview', 5);
      showResult(`Review submission: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testUpliftRequest() {
      log('Testing uplift request protection...', 'info');
      const results = await simulateRapidClicks('submitUpliftRequest', 5);
      showResult(`Uplift request: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testLoginSubmission() {
      log('Testing login submission protection...', 'info');
      updateTestStatus('auth-forms', 'pending');
      const results = await simulateRapidClicks('login', 5);
      updateTestStatus('auth-forms', results.successful === 1 ? 'pass' : 'fail');
      showResult(`Login submission: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testSignupSubmission() {
      log('Testing signup submission protection...', 'info');
      const results = await simulateRapidClicks('signup', 5);
      showResult(`Signup submission: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testGoogleSignIn() {
      log('Testing Google sign-in protection...', 'info');
      const results = await simulateRapidClicks('handleGoogleSignIn', 5);
      showResult(`Google sign-in: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testCustomerPasswordChange() {
      log('Testing customer password change protection...', 'info');
      updateTestStatus('password-change', 'pending');
      const results = await simulateRapidClicks('updateCustomerPassword', 5);
      updateTestStatus('password-change', results.successful === 1 ? 'pass' : 'fail');
      showResult(`Customer password change: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAdminPasswordChange() {
      log('Testing admin password change protection...', 'info');
      const results = await simulateRapidClicks('updateAdminPassword', 5);
      showResult(`Admin password change: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testGroomerPasswordChange() {
      log('Testing groomer password change protection...', 'info');
      const results = await simulateRapidClicks('updateGroomerPassword', 5);
      showResult(`Groomer password change: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testGroomerProfileUpdate() {
      log('Testing groomer profile update protection...', 'info');
      updateTestStatus('groomer-profile', 'pending');
      const results = await simulateRapidClicks('updateGroomerProfile', 5);
      updateTestStatus('groomer-profile', results.successful === 1 ? 'pass' : 'fail');
      showResult(`Groomer profile update: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testGroomerSkillsUpdate() {
      log('Testing groomer skills update protection...', 'info');
      const results = await simulateRapidClicks('updateGroomerSkills', 5);
      showResult(`Groomer skills update: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAbsenceRequest() {
      log('Testing absence request protection...', 'info');
      updateTestStatus('groomer-absence', 'pending');
      const results = await simulateRapidClicks('submitAbsenceRequest', 5);
      updateTestStatus('groomer-absence', results.successful === 1 ? 'pass' : 'fail');
      showResult(`Absence request: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    async function testAbsenceCancellation() {
      log('Testing absence cancellation protection...', 'info');
      const results = await simulateRapidClicks('cancelAbsenceRequest', 5);
      showResult(`Absence cancellation: ${results.successful} successful, ${results.blocked} blocked`, 'info');
    }
    
    // ===========================================
    // CONTROL FUNCTIONS
    // ===========================================
    
    async function runAllTests() {
      if (testInProgress) {
        showResult('Test suite already running, please wait...', 'warning');
        return;
      }
      
      testInProgress = true;
      log('=== STARTING COMPREHENSIVE TEST SUITE ===', 'info');
      showResult('Running all system tests... This may take several minutes.', 'info');
      
      try {
        // Booking System Tests
        await testBookingSubmission();
        await new Promise(resolve => setTimeout(resolve, 1000));
        await testBookingNavigation();
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Admin System Tests
        await testAdminConfirmBooking();
        await new Promise(resolve => setTimeout(resolve, 1000));
        await testAdminCancelBooking();
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Customer System Tests
        await testCustomerProfileUpdate();
        await new Promise(resolve => setTimeout(resolve, 1000));
        await testPaymentProofUpload();
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Authentication Tests
        await testLoginSubmission();
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Groomer Tests
        await testGroomerProfileUpdate();
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        log('=== ALL TESTS COMPLETED ===', 'success');
        showResult(`Test suite completed! Passed: ${stats.passedTests}, Failed: ${stats.failedTests}`, 'success');
        
      } catch (error) {
        log(`Test suite ERROR: ${error.message}`, 'error');
        showResult(`Test suite failed: ${error.message}`, 'error');
      } finally {
        testInProgress = false;
      }
    }
    
    async function runCriticalTests() {
      if (testInProgress) {
        showResult('Test suite already running, please wait...', 'warning');
        return;
      }
      
      testInProgress = true;
      log('=== RUNNING CRITICAL TESTS ONLY ===', 'info');
      
      try {
        await testBookingSubmission();
        await new Promise(resolve => setTimeout(resolve, 500));
        await testAdminConfirmBooking();
        await new Promise(resolve => setTimeout(resolve, 500));
        await testPaymentProofUpload();
        
        log('=== CRITICAL TESTS COMPLETED ===', 'success');
        showResult('Critical tests completed!', 'success');
      } catch (error) {
        showResult(`Critical tests failed: ${error.message}`, 'error');
      } finally {
        testInProgress = false;
      }
    }
    
    function runCustomTest() {
      showResult('Custom test suite feature coming soon!', 'info');
    }
    
    function resetAllTests() {
      testResults = {};
      stats = { totalTests: 0, passedTests: 0, failedTests: 0, pendingTests: 0 };
      
      // Reset all status indicators
      document.querySelectorAll('.status-indicator').forEach(indicator => {
        indicator.className = 'status-indicator status-untested';
      });
      
      updateStats();
      clearLog();
      document.getElementById('results').innerHTML = '';
      
      log('All tests reset', 'info');
      showResult('All tests have been reset', 'success');
    }
    
    function exportResults() {
      const results = {
        timestamp: new Date().toISOString(),
        stats: stats,
        testResults: testResults,
        config: TEST_CONFIG
      };
      
      const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `stress-test-results-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      showResult('Test results exported successfully!', 'success');
    }
    
    function generateReport() {
      const report = `
# System-Wide Stress Test Report
Generated: ${new Date().toLocaleString()}

## Summary
- Total Tests: ${stats.totalTests}
- Passed: ${stats.passedTests}
- Failed: ${stats.failedTests}
- Pending: ${stats.pendingTests}

## Test Results
${Object.entries(testResults).map(([test, status]) => `- ${test}: ${status.toUpperCase()}`).join('\n')}

## Recommendations
${stats.failedTests > 0 ? 'âš ï¸ CRITICAL: Some tests failed. Review failed tests and implement proper duplicate prevention.' : 'âœ… All tests passed. System duplicate prevention is working correctly.'}
      `;
      
      const blob = new Blob([report], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `stress-test-report-${new Date().toISOString().split('T')[0]}.md`;
      a.click();
      URL.revokeObjectURL(url);
      
      showResult('Test report generated successfully!', 'success');
    }
  </script>
</body>
</html>